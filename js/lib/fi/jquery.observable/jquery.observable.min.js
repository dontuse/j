/**
 * Observable plugin
 *
 * Copyright (c) 2010 Filatov Dmitry (alpha@zforms.ru)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * @version 1.0.2
 * @requires $.identify
 * @requires $.inherit
 */(function(a,b){var c="__"+ +(new Date)+"storage",d=function(b,c){return a.identify(b)+(c?a.identify(c):"")},e={buildEventName:function(a){return a},on:function(e,f,g,h,i){var j=this;if(typeof e=="string"){a.isFunction(f)&&(h=g,g=f,f=b);var k=d(g,h),l=j[c]||(j[c]={}),m=e.split(" "),n=0,o;while(e=m[n++]){e=j.buildEventName(e),o=l[e]||(l[e]={ids:{},list:{}});if(!(k in o.ids)){var p=o.list,q={fn:g,data:f,ctx:h,special:i};p.last?(p.last.next=q,q.prev=p.last):p.first=q,o.ids[k]=p.last=q}}}else a.each(e,function(a,b){j.on(a,b,f,i)});return j},once:function(a,b,c,d){return this.on(a,b,c,d,{one:!0})},un:function(b,e,f){var g=this;if(typeof b=="string"||typeof b=="undefined"){var h=g[c];if(h)if(b){var i=b.split(" "),j=0,k;while(b=i[j++]){b=g.buildEventName(b);if(k=h[b])if(e){var l=d(e,f),m=k.ids;if(l in m){var n=k.list,o=m[l],p=o.prev,q=o.next;p?p.next=q:o===n.first&&(n.first=q),q?q.prev=p:o===n.last&&(n.last=p),delete m[l]}}else delete g[c][b]}}else delete g[c]}else a.each(b,function(a,b){g.un(a,b,f)});return g},trigger:function(b,d){var e=this,f=e[c],g;typeof b=="string"?b=a.Event(e.buildEventName(g=b)):b.type=e.buildEventName(g=b.type),b.target||(b.target=e);if(f&&(f=f[b.type])){var h=f.list.first,i;while(h)b.data=h.data,i=h.fn.call(h.ctx||e,b,d),typeof i!="undefined"&&(b.result=i,i===!1&&(b.preventDefault(),b.stopPropagation())),h.special&&h.special.one&&e.un(g,h.fn,h.ctx),h=h.next}return e}};a.observable=a.inherit(e,e)})(jQuery);